<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>记录我的点滴</title>
  
  <subtitle>Yu Blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-03-10T08:32:09.513Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>boygreen_Yu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>系统了解前端性能优化的手段</title>
    <link href="http://yoursite.com/2020/03/10/%E7%B3%BB%E7%BB%9F%E4%BA%86%E8%A7%A3%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%89%8B%E6%AE%B5/"/>
    <id>http://yoursite.com/2020/03/10/系统了解前端性能优化的手段/</id>
    <published>2020-03-10T08:32:09.000Z</published>
    <updated>2020-03-10T08:32:09.513Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>图片压缩</title>
    <link href="http://yoursite.com/2020/03/10/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/"/>
    <id>http://yoursite.com/2020/03/10/图片压缩/</id>
    <published>2020-03-10T07:45:47.000Z</published>
    <updated>2020-03-10T07:45:47.585Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>HTTP压缩</title>
    <link href="http://yoursite.com/2020/03/10/HTTP%E5%8E%8B%E7%BC%A9/"/>
    <id>http://yoursite.com/2020/03/10/HTTP压缩/</id>
    <published>2020-03-10T07:23:45.000Z</published>
    <updated>2020-03-10T08:48:24.582Z</updated>
    
    <content type="html"><![CDATA[<h4 id="什么是HTTP压缩"><a href="#什么是HTTP压缩" class="headerlink" title="什么是HTTP压缩"></a><strong>什么是HTTP压缩</strong></h4><p>HTTP压缩是指: Web服务器和浏览器之间压缩传输”文本内容“的方法。 HTTP采用通用的压缩算法，比如gzip来压缩HTML,Javascript, CSS文件。 能大大减少网络传输的数据量，提高了用户显示网页的速度。当然，同时会增加一点点服务器的开销。 本文从HTTP协议的角度，来理解HTTP压缩这个概念。</p><h4 id="HTTP内容编码和HTTP压缩的区别"><a href="#HTTP内容编码和HTTP压缩的区别" class="headerlink" title="HTTP内容编码和HTTP压缩的区别"></a><strong>HTTP内容编码和HTTP压缩的区别</strong></h4><p>HTTP压缩，在HTTP协议中，其实是内容编码的一种。</p><p>在http协议中，可以对内容（也就是body部分）进行编码， 可以采用Gzip这样的编码。 从而达到压缩的目的。 也可以使用其他的编码把内容搅乱或加密，以此来防止未授权的第三方看到文档的内容。所以我们说HTTP压缩，其实就是HTTP内容编码的一种。 所以大家不要把HTTP压缩和HTTP内容编码两个概念混淆了。</p><h4 id="内容编码类型"><a href="#内容编码类型" class="headerlink" title="内容编码类型"></a><strong>内容编码类型</strong></h4><p>HTTP定义了一些标准的内容编码类型，并允许用扩展的形式添加更多的编码。</p><p>Content-Encoding header 就用这些标准化的代号来说明编码时使用的算法</p><p>Content-Encoding值</p><p>　　gzip　　表明实体采用GNU zip编码</p><p>　　compress 表明实体采用Unix的文件压缩程序</p><p>　　deflate　　表明实体是用zlib的格式压缩的</p><p>　　identity　　表明没有对实体进行编码。当没有Content-Encoding header时， 就默认为这种情况</p><p>　　Gzip, compress, 以及deflate编码都是<code>无损压缩算法</code>，用于减少传输报文的大小，不会导致信息损失。 其中<code>Gzip</code>通常<strong>效率最高</strong>， 使用最为广泛。</p><h4 id="Gzip的缺点"><a href="#Gzip的缺点" class="headerlink" title="Gzip的缺点"></a><strong>Gzip的缺点</strong></h4><p> <code>jpeg</code>这类文件用<code>gzip</code>压缩的不够好。</p><p>对HTTP传输内容进行压缩是改良前端响应性能的可用方法之一，大型网站都在用。但是也有缺点，就是压缩过程占用cpu的资源，客户端浏览器解析也占据了一部分时间。但是随着硬件性能不断的提高，这些问题正在不断的弱化。</p><h4 id="Gzip压缩原理"><a href="#Gzip压缩原理" class="headerlink" title="Gzip压缩原理"></a><strong>Gzip压缩原理</strong></h4><p>简单来说， Gzip压缩是在一个文本文件中找出类似的字符串， 并临时替换他们，使整个文件变小。这种形式的压缩对Web来说非常适合， 因为<code>HTML</code>、<code>CSS</code>、<code>js</code>文件通常包含大量的重复的字符串，例如空格，标签。</p><h4 id="http协议如何支持压缩文件的传输"><a href="#http协议如何支持压缩文件的传输" class="headerlink" title="http协议如何支持压缩文件的传输"></a>http协议如何支持压缩文件的传输</h4><p>1、浏览器请求数据时，通过<code>Accept-Encoding</code>（<code>Request Header</code>）说明自己可以接受的压缩方法</p><p>2、服务端接收到请求后，选取Accept-Encoding中的一种对响应数据进行压缩</p><p>3、服务端返回响应数据时，在<code>Content-Encoding</code>（<code>Response Header</code>）字段中说明数据的压缩方式</p><p>4、浏览器接收到响应数据后根据Content-Encoding对结果进行解压</p><p>注：如果服务器没有对响应数据进行压缩，则不返回Content-Encoding，浏览器也不进行解压</p><h4 id="什么时候压缩"><a href="#什么时候压缩" class="headerlink" title="什么时候压缩"></a>什么时候压缩</h4><p><img src="/home/boygreen/%E5%9B%BE%E7%89%87/571311-20180831155733264-1153384828.png" alt></p><h4 id="构建时压缩（webpack）"><a href="#构建时压缩（webpack）" class="headerlink" title="构建时压缩（webpack）"></a>构建时压缩（webpack）</h4><p><code>webpack</code>的<code>compression-webpack-plugin</code>插件用于支持构建项目时压缩文件，Vue项目为例，具体配置如下：</p><p>1、首先安装插件，命令：npm install –save-dev compression-webpack-plugin</p><p>2、在config/index.js文件中打开Gzip开关，配置需要压缩的文件扩展名</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">productionGzip: <span class="literal">true</span>,</span><br><span class="line">productionGzipExtensions: [<span class="string">'js'</span>, <span class="string">'css'</span>],</span><br></pre></td></tr></table></figure><p>3、webpack.prod.conf.js中设置具体压缩配置项</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.build.productionGzip) &#123;</span><br><span class="line">  <span class="keyword">const</span> CompressionWebpackPlugin = <span class="built_in">require</span>(<span class="string">'compression-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line">  webpackConfig.plugins.push(</span><br><span class="line">    <span class="keyword">new</span> CompressionWebpackPlugin(&#123;</span><br><span class="line">      asset: <span class="string">'[path].gz[query]'</span>,</span><br><span class="line">      algorithm: <span class="string">'gzip'</span>,</span><br><span class="line">      test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(</span><br><span class="line">        <span class="string">'\\.('</span> + </span><br><span class="line">        config.build.productionGzipExtensions.join(<span class="string">'|'</span>) +</span><br><span class="line">        <span class="string">')$'</span></span><br><span class="line">      ),</span><br><span class="line">      threshold: <span class="number">10240</span>,</span><br><span class="line">      minRatio: <span class="number">0.8</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、打包后会同时保留原文件和压缩后的文件，存储等条件允许的情况下，原文件也建议发布到服务器以支持不兼容gzip的浏览器</p><p>5、服务端<code>nginx</code>启动<code>gzip_static</code></p><p>gzip_static是nginx对于静态文件的处理模块，该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的CPU资源消耗。该模块启用后，nginx首先检查是否存在请求静态文件的gz结尾的文件，如果有则直接返回该gz文件内容。</p><p>为了要兼容不支持gzip的浏览器，启用gzip_static模块就必须同时保留原始静态文件和gz文件。这样的话，在有大量静态文件的情况下，将会大大增加磁盘空间。我们可以利用nginx的反向代理功能实现只保留gz文件。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;什么是HTTP压缩&quot;&gt;&lt;a href=&quot;#什么是HTTP压缩&quot; class=&quot;headerlink&quot; title=&quot;什么是HTTP压缩&quot;&gt;&lt;/a&gt;&lt;strong&gt;什么是HTTP压缩&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;HTTP压缩是指: Web服务器和浏览器之间压缩传
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Promise/A+原理</title>
    <link href="http://yoursite.com/2020/03/07/Promise-A-%E5%8E%9F%E7%90%86/"/>
    <id>http://yoursite.com/2020/03/07/Promise-A-原理/</id>
    <published>2020-03-07T13:19:37.000Z</published>
    <updated>2020-03-08T05:24:32.517Z</updated>
    
    <content type="html"><![CDATA[<p>基本过程：</p><ol><li>初始化 Promise 状态（<code>pending</code>）</li><li>立即执行 Promise 中传入的 fn 函数，将Promise 内部 resolve、reject 函数作为参数传递给 fn ，按事件机制时机处理</li><li>执行 then(..) 注册回调处理数组（<strong>then 方法可被同一个 promise 调用多次</strong>）</li><li><strong><code>Promise</code>里的关键是要保证，then方法传入的参数 onFulfilled 和 <code>onRejected</code>，必须在<code>then</code>方法被调用的那一轮事件循环之后的新执行栈中执行。</strong></li></ol><p>拆分：</p><h4 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h4><p>先从 Promise 执行结果看一下，有如下一段代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        resolve(&#123; <span class="attr">test</span>: <span class="number">1</span> &#125;)</span><br><span class="line">        resolve(&#123; <span class="attr">test</span>: <span class="number">2</span> &#125;)</span><br><span class="line">        reject(&#123; <span class="attr">test</span>: <span class="number">2</span> &#125;)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'result1'</span>, data)</span><br><span class="line">&#125;,(data1)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'result2'</span>,data1)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'result3'</span>, data)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//result1 &#123; test: 1 &#125;</span></span><br><span class="line"><span class="comment">//result3 undefined</span></span><br></pre></td></tr></table></figure><p>coding</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;基本过程：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;初始化 Promise 状态（&lt;code&gt;pending&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;立即执行 Promise 中传入的 fn 函数，将Promise 内部 resolve、reject 函数作为参数传递给 fn ，按事件机制时机
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>必备的chrome插件</title>
    <link href="http://yoursite.com/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/"/>
    <id>http://yoursite.com/2020/03/06/必备的chrome插件/</id>
    <published>2020-03-06T07:40:20.000Z</published>
    <updated>2020-03-06T08:42:29.573Z</updated>
    
    <content type="html"><![CDATA[<p><strong>插件都在<a href="https://chrome.zzzmh.cn/index" target="_blank" rel="noopener">极简插件</a>搜索下载即可</strong></p><h3 id="第一部分-日常使用"><a href="#第一部分-日常使用" class="headerlink" title="第一部分 (日常使用)"></a>第一部分 (日常使用)</h3><h4 id="沙拉查词"><a href="#沙拉查词" class="headerlink" title="沙拉查词"></a>沙拉查词</h4><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/saladict.gif" alt></p><h4 id="Infinity-新标签页"><a href="#Infinity-新标签页" class="headerlink" title="Infinity 新标签页"></a>Infinity 新标签页</h4><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/infinity-home.png" alt></p><blockquote><p>替换 chrome 原有首页的一个选择, 功能完善, 可以方便的管理和查找书签, 每天更换一个壁纸, 点击下边的小风车, 可以随机切换壁纸</p><p>不仅如此, 点击右上角的 + 号, 可进行登录, 常规, 外观, 壁纸设置, 还可以对标签页的图标进行整理替换</p></blockquote><h4 id="Momentum"><a href="#Momentum" class="headerlink" title="Momentum"></a>Momentum</h4><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/640.png" alt></p><blockquote><p>替换 chrome 原有首页的插件, 简介大气, 左上角可以搜索, 右上角展示天气, 中间展示时间, 下方默认有个 todo 的功能, 左下角可以对标签页进行设置, 新增一些功能</p></blockquote><h4 id="Vimium-The-Hacker’s-Browser"><a href="#Vimium-The-Hacker’s-Browser" class="headerlink" title="Vimium - The Hacker’s Browser"></a>Vimium - The Hacker’s Browser</h4><p><code>vimium</code> = vim + chromium, vim 是 <code>linux</code> 自带的文本编辑器, 通过各种快捷键, 完全脱离鼠标操作, 而 <code>vimium</code> 则继承了 vim 的常用快捷键, 让你脱离鼠标操作 <code>chrome</code></p><p>f 的效果如下</p><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/vimium-f.png" alt></p><h4 id="crxMouse-Chrome™-手势"><a href="#crxMouse-Chrome™-手势" class="headerlink" title="crxMouse Chrome™ 手势"></a>crxMouse Chrome™ 手势</h4><p>这个插件与 <code>vimium</code> 相反, 增强了鼠标的功能</p><p>如果要在新标签页打开一个链接, 在链接上方, 按住鼠标向左拖动即可</p><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/crxMouse-openLinkInNewTab.png" alt></p><h3 id="第二部分-协助开发"><a href="#第二部分-协助开发" class="headerlink" title="第二部分 (协助开发)"></a>第二部分 (协助开发)</h3><h4 id="FeHelper"><a href="#FeHelper" class="headerlink" title="FeHelper"></a>FeHelper</h4><p><code>FeHelper</code> 由 <code>Alien</code> 开源, 是一款前端工具集大成的插件, 前端开发必备:</p><p>先祭出官网介绍的功能菜单感受一下:</p><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/fe-helper-0.png" alt="fe-helper-0"></p><p>挑几个功能介绍一下</p><ul><li>字符串加解密</li></ul><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/fe-helper-1.png" alt></p><ul><li><code>JSON</code> 格式化</li></ul><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/fe-helper-2.png" alt></p><ul><li>二维码生成工具</li></ul><p>右键打开菜单, 点击 <code>FeHelper</code> 的二维码生成器, 即可生成当前页面的二维码, 可以配置自定义图标, 另外还可以改动 <code>url</code> 进行实时编辑, 调试页面的时候在 <code>pc</code> 打开, 生成二维码后, 就不用手动在手机输入 <code>url</code> 了~</p><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/fe-helper-3.png" alt></p><ul><li>正则表达式工具</li></ul><p>可以帮助生成常用的正则表达式, 可以看表达式是否匹配, 在正则调试过程中可以起到较好地辅助作用</p><h4 id="SwitchyOmega"><a href="#SwitchyOmega" class="headerlink" title="SwitchyOmega"></a>SwitchyOmega</h4><p>强大的浏览器代理工具</p><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/switchyomega-0.png" alt></p><h4 id="React-Developer-Tools"><a href="#React-Developer-Tools" class="headerlink" title="React Developer Tools"></a>React Developer Tools</h4><h4 id="Redux-DevTools"><a href="#Redux-DevTools" class="headerlink" title="Redux DevTools"></a>Redux DevTools</h4><h4 id="Vue-js-devtools"><a href="#Vue-js-devtools" class="headerlink" title="Vue.js devtools"></a>Vue.js devtools</h4><h4 id="Octotree"><a href="#Octotree" class="headerlink" title="Octotree"></a>Octotree</h4><p>让浏览 <code>github</code> 代码变得像本地编辑器一样轻松, 可以搜索文件, 点击代码目录跳转等, 方便地在文件之间切换</p><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/octotree.gif" alt></p><h3 id="第三部分-插件管理"><a href="#第三部分-插件管理" class="headerlink" title="第三部分 (插件管理)"></a>第三部分 (插件管理)</h3><h4 id="SimpleExtManager-插件管理"><a href="#SimpleExtManager-插件管理" class="headerlink" title="SimpleExtManager (插件管理)"></a>SimpleExtManager (插件管理)</h4><p>这是一款可以管理插件的插件, 让你方便地禁用, 启用和删除插件, 当插件多起来的时候, 会影响 chrome 的速度, 为了在需要某个插件时, 能快速的启动某个插件, SimpleExtManager 就必不可少了</p><p><img src="https://thinkerhope.github.io/2020/03/06/%E5%BF%85%E5%A4%87%E7%9A%84chrome%E6%8F%92%E4%BB%B6/simpleext.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;插件都在&lt;a href=&quot;https://chrome.zzzmh.cn/index&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;极简插件&lt;/a&gt;搜索下载即可&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;第一部分-日常使用&quot;&gt;&lt;a href
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>EventLoop遇上Promise</title>
    <link href="http://yoursite.com/2020/03/05/EventLoop%E9%81%87%E4%B8%8APromise/"/>
    <id>http://yoursite.com/2020/03/05/EventLoop遇上Promise/</id>
    <published>2020-03-05T13:42:11.000Z</published>
    <updated>2020-03-09T04:06:32.224Z</updated>
    
    <content type="html"><![CDATA[<p>面试时的<code>EventLoop/Promise</code>难度进阶</p><h4 id="版本一：得心应手版"><a href="#版本一：得心应手版" class="headerlink" title="版本一：得心应手版"></a>版本一：得心应手版</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="number">1</span>) </span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="number">2</span>) </span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p><strong>考察点</strong>：了解宏任务(<code>marcotask</code>)微任务</p><h4 id="版本二：游刃有余版"><a href="#版本二：游刃有余版" class="headerlink" title="版本二：游刃有余版"></a>版本二：游刃有余版</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="number">1</span>) </span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> a=<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="number">3</span>) </span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="number">4</span>) </span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p><strong>考察点</strong>：Promise的理解程度</p><h4 id="版本三：炉火纯青版"><a href="#版本三：炉火纯青版" class="headerlink" title="版本三：炉火纯青版"></a>版本三：炉火纯青版</h4><p>首先理解一下以下执行（这个更好理解）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 题１</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"promise1"</span>)</span><br><span class="line">  resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"then11"</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"then12"</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"then13"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"promise2"</span>)</span><br><span class="line">  resolve()</span><br><span class="line">&#125;).then(()= &gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"then21"</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"then23"</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">　<span class="built_in">console</span>.log(<span class="string">"then24"</span>) </span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">　<span class="built_in">console</span>.log(<span class="string">"then25"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line">promise1</span><br><span class="line">promise2</span><br><span class="line">then11</span><br><span class="line">then21</span><br><span class="line">then12</span><br><span class="line">then23</span><br><span class="line">then24</span><br><span class="line">then25</span><br></pre></td></tr></table></figure><p><code>then</code>返回的<code>promise</code>要等该<code>then</code>注册的回调执行完才<code>resolve</code></p><p>按我能现在接受的理解是：<code>new Promise(fn)</code>，<code>fn</code>毫无疑问是立即执行的，（<code>resolve</code>是异步），之后所有<code>then</code>同步执行完，返回<code>Promise{&lt;pending&gt;}</code>，（期间注册回调，注意不是放到<code>microqueue</code>中，只是放到<code>promise</code>的<code>callback</code>属性中）每个<code>promise</code>都在等待<code>resolve</code>后变为<code>fulfilled</code>才把注册的回调<code>microtask(fn)</code>，立刻放到微任务队列中，如此循环。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 题２</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"promise1"</span>)</span><br><span class="line">  resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"then11"</span>)</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"promise2"</span>)</span><br><span class="line">      resolve()</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"then21"</span>)</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"then23"</span>)</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">    　<span class="built_in">console</span>.log(<span class="string">"then24"</span>) </span><br><span class="line">  &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">    　<span class="built_in">console</span>.log(<span class="string">"then25"</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  　<span class="built_in">console</span>.log(<span class="string">"then12"</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">  　<span class="built_in">console</span>.log(<span class="string">"then13"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 抛开同步执行的`promise1`和`promise2`，结果和题２是一致的</span></span><br><span class="line"><span class="comment">// new Promise resolve后then回调会立即入队，遇到new promise理解执行函数中如果resolve效果感觉是同步的，会让then回调立即入队。</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line">promise1</span><br><span class="line">then11</span><br><span class="line">promise2</span><br><span class="line">then21</span><br><span class="line">then12</span><br><span class="line">then23</span><br><span class="line">then24</span><br><span class="line">then25</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 题３ - 检验上面的理解</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise1"</span>,<span class="number">1</span>) </span><br><span class="line">    resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then11"</span>,<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"promise2"</span>,<span class="number">3</span>)</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"then21"</span>,<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"promise3"</span>,<span class="number">5</span>)</span><br><span class="line">            resolve();</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"then31"</span>,<span class="number">7</span>)</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"then32"</span>,<span class="number">9</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"then22"</span>,<span class="number">8</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then12"</span>,<span class="number">6</span>)</span><br><span class="line">&#125;)  </span><br><span class="line"><span class="comment">// 按照上面的理解是可以解释这一题的</span></span><br><span class="line"><span class="comment">// 即入队顺序：then11 -&gt; then21 -&gt; then12 -&gt; then31 -&gt; then22 -&gt; then32</span></span><br></pre></td></tr></table></figure><p>做到心中有队列（current stack 和 micro stack一直在）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 题４</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise1"</span>)</span><br><span class="line">    resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then11"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"promise2"</span>)</span><br><span class="line">        resolve()</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"then21"</span>)</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"then23"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then12"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line">promise1</span><br><span class="line">then11</span><br><span class="line">promise2</span><br><span class="line">then21</span><br><span class="line">then23</span><br><span class="line">then12</span><br></pre></td></tr></table></figure><h4 id="版本四：登峰造极版"><a href="#版本四：登峰造极版" class="headerlink" title="版本四：登峰造极版"></a>版本四：登峰造极版</h4><blockquote><p>考点：在<code>async/await</code>之下，对<code>Eventloop</code>的影响</p></blockquote><blockquote><p>槽点：别被<code>async/await</code>给骗了，这题不难。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async1 start"</span>)</span><br><span class="line">    <span class="keyword">await</span> async2();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async1 end"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span>  <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">'async2'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"script start"</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"settimeout"</span>)</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">async1()</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise1"</span>)</span><br><span class="line">    resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise2"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script end'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line">script start</span><br><span class="line">async1 start</span><br><span class="line">async2</span><br><span class="line">promise1</span><br><span class="line">script end</span><br><span class="line">async1 end</span><br><span class="line">promise2</span><br><span class="line">settimeout</span><br></pre></td></tr></table></figure><p>这里该题作者给的解释：</p><p><code>await async2()</code>相当于一个<code>Promise</code>，<code>console.log(&quot;async1 end&quot;);</code>相当于前方<code>Promise</code>的<code>then</code>之后执行的函数</p><p><strong>此处唯一有争议的就是<code>async</code>的<code>then</code>和<code>promise</code>的<code>then</code>的优先级的问题</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async1 start"</span>)</span><br><span class="line">    <span class="keyword">await</span> async2()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async1 end"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async2'</span>)</span><br><span class="line">&#125;</span><br><span class="line">async1()</span><br><span class="line"><span class="comment">// 用于test的promise，看看await究竟在何时执行</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise1"</span>)</span><br><span class="line">    resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise2"</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise3"</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise4"</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise5"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line">async1 start</span><br><span class="line">async2</span><br><span class="line">promise1</span><br><span class="line">async1 end</span><br><span class="line">promise2</span><br><span class="line">promise3</span><br><span class="line">promise4</span><br><span class="line">promise5</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;面试时的&lt;code&gt;EventLoop/Promise&lt;/code&gt;难度进阶&lt;/p&gt;
&lt;h4 id=&quot;版本一：得心应手版&quot;&gt;&lt;a href=&quot;#版本一：得心应手版&quot; class=&quot;headerlink&quot; title=&quot;版本一：得心应手版&quot;&gt;&lt;/a&gt;版本一：得心应手版&lt;/h4
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>时间锁</title>
    <link href="http://yoursite.com/2020/03/03/%E6%97%B6%E9%97%B4%E9%94%81/"/>
    <id>http://yoursite.com/2020/03/03/时间锁/</id>
    <published>2020-03-03T14:47:30.000Z</published>
    <updated>2020-03-03T15:07:45.114Z</updated>
    
    <content type="html"><![CDATA[<h2 id="时间锁修复bug"><a href="#时间锁修复bug" class="headerlink" title="时间锁修复bug"></a>时间锁修复bug</h2><blockquote><p>有时候2行代码能简单处理的问题就不用大费周章地瞎搞了</p></blockquote><h4 id="点击穿透"><a href="#点击穿透" class="headerlink" title="点击穿透"></a>点击穿透</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下方法在 IOS 下无效，而且不建议用异步的定时器</span></span><br><span class="line"><span class="keyword">const</span> handleAddClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> handleTouchStart = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> handleTouchEnd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> btnAddRef.current.addEventListener(<span class="string">'click'</span>, handleAddClick), <span class="number">300</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span>  btnAddRef.current.removeEventListener(<span class="string">'click'</span>, handleAddClick)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;div onTouchStart=&#123;handleTouchStart&#125; onTouchEnd=&#123;handleTouchEnd&#125;&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    ref=&#123;btnRef&#125;</span><br><span class="line">    onClick=&#123;e =&gt; handleClick(e)&#125;   </span><br><span class="line">  &gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间锁的解决方案</span></span><br><span class="line"><span class="keyword">const</span> [lockTime, setLockTime] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleAddClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> now = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  <span class="keyword">if</span> (now - lockTime &lt; <span class="number">300</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleTouchStart = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  setLockTime(+<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="多指触屏"><a href="#多指触屏" class="headerlink" title="多指触屏"></a>多指触屏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;时间锁修复bug&quot;&gt;&lt;a href=&quot;#时间锁修复bug&quot; class=&quot;headerlink&quot; title=&quot;时间锁修复bug&quot;&gt;&lt;/a&gt;时间锁修复bug&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;有时候2行代码能简单处理的问题就不用大费周章地瞎搞了&lt;/p&gt;
&lt;/
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>hammerJS</title>
    <link href="http://yoursite.com/2020/03/01/hammerJS/"/>
    <id>http://yoursite.com/2020/03/01/hammerJS/</id>
    <published>2020-03-01T03:03:40.000Z</published>
    <updated>2020-03-01T09:15:35.912Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JS手势框架-——-Hammer-js"><a href="#JS手势框架-——-Hammer-js" class="headerlink" title="JS手势框架 —— Hammer.js"></a>JS手势框架 —— Hammer.js</h2><p><img src="https://thinkerhope.github.io/2020/03/01/hammerJS/hammer.jpg" alt></p><h4 id="hammer-js简介"><a href="#hammer-js简介" class="headerlink" title="hammer.js简介"></a>hammer.js简介</h4><p><code>hammerJS</code>是一个开源的，轻量级的触屏设备<code>javascript</code>手势库，它可以在不需要依赖其他东西的情况下识别触摸，鼠标事件。允许同时监听多个手势、自定义识别器，也可以识别滑动方向。</p><h4 id="事件介绍"><a href="#事件介绍" class="headerlink" title="事件介绍"></a>事件介绍</h4><p><img src="https://thinkerhope.github.io/2020/03/01/hammerJS/hammerEvent.png" alt></p><p>1、<code>Rotate</code>事件：在指定的<code>dom</code>区域内，当两个手指或更多手指成圆型旋转时触发（就像两个手指拧螺丝一样）。该事件分别对以下事件进行监听并处理：</p><p><code>Rotatestart</code>：旋转开始；</p><p><code>Rotatemove</code>：旋转过程；</p><p><code>Rotateend</code>：旋转结束；</p><p>Rotatecancel：旋转取消</p><p>2、<code>Pinch</code>事件：在指定的dom区域内，两个手指（默认为两个手指，多指触控需要单独设置）或多个手指相对（越来越近）移动或相向（越来越远）移动时事件。该事件事以分别对以下事件进行监听并处理：</p><p><code>Pinchstart</code>：多点触控开始；</p><p><code>Pinchmove</code>：多点触控过程；</p><p><code>Pinchend</code>：多点触控结束；</p><p><code>Pinchcancel</code>：多点触控取消；</p><p><code>Pinchin</code>：多点触控时两手指距离越来越近；</p><p><code>Pinchout</code>：多点触控时两手指距离越来越远</p><p>3、<code>Press</code>事件：在指定的dom区域内触屏版本的点击事件，这个事件相当于PC端的<code>Click</code>事件，该不能包含任何的移动，最小按压时间为500毫秒，常用于我们在手机上用的“复制、粘贴”等功能。</p><p><code>Pressup</code>：点击事件离开时触发</p><p>4、<code>Pan</code>事件：在指定的dom区域内，一个手指放下并移动事件，即触屏中的拖动事件。这个事件在屏触开发中比较常用，如：左拖动、右拖动等，如手要上使用QQ时向右滑动出现功能菜单的效果。该事件还可以分别对以下事件进行监听并处理：</p><p><code>Panstart</code>：拖动开始；</p><p><code>Panmove</code>：拖动过程；</p><p><code>Panend</code>：拖动结束；</p><p><code>Pancancel</code>：拖动取消；</p><p><code>Panleft</code>：向左拖动；</p><p><code>Panright</code>：向右拖动；</p><p><code>Panup</code>：向上拖动；</p><p><code>Pandown</code>：向下拖动 </p><p>5、<code>Tap</code>事件：在指定的dom区域内，一个手指轻拍或点击时触发该事件(类似PC端的click)。该事件最大点击时间为250毫秒，如果超过250毫秒则按Press事件进行处理。</p><p>6、<code>Swipe</code>事件：在指定的dom区域内，一个手指快速的在触屏上滑动。即我们平时用到最多的滑动事件。</p><p><code>Swipeleft</code>：向左滑动；</p><p><code>Swiperight</code>：向右滑动；</p><p><code>Swipeup</code>：向上滑动；</p><p><code>Swipedown</code>：向下滑动</p><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><blockquote><p>安装</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hammerjs</span><br></pre></td></tr></table></figure><blockquote><p>基本使用</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> square = <span class="built_in">document</span>.querySelector(<span class="string">'.square'</span>);</span><br><span class="line"><span class="keyword">var</span> hammer = <span class="keyword">new</span> Hammer(square);</span><br><span class="line"><span class="comment">// 若要允许识别器识别垂直方位的 pan 和 swipe</span></span><br><span class="line"><span class="comment">// hammertime.get('pan').set(&#123; direction: Hammer.DIRECTION_VERTICAL &#125;)</span></span><br><span class="line">mc.get(<span class="string">"pan"</span>).set(&#123; <span class="attr">direction</span>: Hammer.DIRECTION_ALL &#125;);</span><br><span class="line">hammer.on(<span class="string">'pan'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  e.target.classList.toggle(<span class="string">'expand'</span>, i &lt; <span class="number">10</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 另建议加上如下meta标签，防止doubletap 或 pinch 缩放了viewport：</span></span><br><span class="line"><span class="comment">// &lt;meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;JS手势框架-——-Hammer-js&quot;&gt;&lt;a href=&quot;#JS手势框架-——-Hammer-js&quot; class=&quot;headerlink&quot; title=&quot;JS手势框架 —— Hammer.js&quot;&gt;&lt;/a&gt;JS手势框架 —— Hammer.js&lt;/h2&gt;&lt;p&gt;&lt;i
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>EventEmitter</title>
    <link href="http://yoursite.com/2020/01/20/EventEmitter%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"/>
    <id>http://yoursite.com/2020/01/20/EventEmitter组件通信/</id>
    <published>2020-01-20T09:47:51.000Z</published>
    <updated>2020-03-03T14:45:29.078Z</updated>
    
    <content type="html"><![CDATA[<h2 id="EventEmitter"><a href="#EventEmitter" class="headerlink" title="EventEmitter"></a>EventEmitter</h2><h4 id="非嵌套关系的组件实现通信"><a href="#非嵌套关系的组件实现通信" class="headerlink" title="非嵌套关系的组件实现通信"></a>非嵌套关系的组件实现通信</h4><blockquote><p>在<code>componentDidMount</code>事件中,如果组件挂载完成,再订阅事件;在组件卸载的时候,在<code>componentWillUnmount</code>事件中取消事件的订阅; 以常用的发布/订阅模式举例,借用<code>Node.js Events</code>模块的浏览器版实现</p></blockquote><p>实现这样一个功能: 点击<code>List2</code>中的一个按钮,改变<code>List1</code>中的信息显示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install events --save</span><br></pre></td></tr></table></figure><p>在<code>src</code>下新建一个<code>util</code>目录里面建一个<code>events.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; EventEmitter &#125; <span class="keyword">from</span> <span class="string">'events'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> EventEmitter();</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list1.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> emitter <span class="keyword">from</span> <span class="string">'../util/events'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            message: <span class="string">'List1'</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="comment">// 组件装载完成以后声明一个自定义事件</span></span><br><span class="line">        <span class="keyword">this</span>.eventEmitter = emitter.addListener(<span class="string">'changeMessage'</span>, (message) =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                message,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        emitter.removeListener(<span class="keyword">this</span>.eventEmitter);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;<span class="keyword">this</span>.state.message&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default List;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// List2.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> emitter <span class="keyword">from</span> <span class="string">'../util/events'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List2</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    handleClick = <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">        emitter.emit(<span class="string">'changeMessage'</span>, message);</span><br><span class="line">    &#125;;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>, <span class="string">'List2'</span>)&#125;&gt;点击我改变List1组件中显示信息&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// APP.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> List1 <span class="keyword">from</span> <span class="string">'./components/List1'</span>;</span><br><span class="line"><span class="keyword">import</span> List2 <span class="keyword">from</span> <span class="string">'./components/List2'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;List1 /&gt;</span><br><span class="line">                &lt;List2 /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>自定义事件是典型的发布订阅模式,通过向事件对象上添加监听器和触发事件来实现组件之间的通信</p><p>（2）辅助 <code>toolbox</code> 实现 <code>create</code> 和 <code>destory</code></p><p>需求是一个长按弹出的 <code>toolbox</code> 框框，要实现点击其它非 toolbox 区域框框消失的功能</p><p>之前的方式: </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/toolbox.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToolboxCtrl</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  create(args) &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    render(</span><br><span class="line">      &lt;<span class="keyword">this</span>.tb </span><br><span class="line">        &#123;...props&#125;</span><br><span class="line">        handleClickAway=&#123;() =&gt; <span class="keyword">this</span>.destory()&#125; </span><br><span class="line">      /&gt;, </span><br><span class="line">      div</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  destory() &#123;&#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// com/toolbox.js</span></span><br><span class="line"><span class="keyword">const</span> ToolBox = <span class="function">(<span class="params">&#123; handleClickAway &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useClickAway(<span class="function"><span class="params">()</span> =&gt;</span> handleClickAway())</span><br><span class="line">  <span class="keyword">const</span> handleItemClick = <span class="function"><span class="params">e</span> =&gt;</span> handleClickAway()</span><br><span class="line">  <span class="keyword">return</span> (&lt;div ref=&#123;ref&#125; onClick=&#123;e =&gt; handleItemClick(e)&#125;&gt;...&lt;/div&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>useClickAway</code> 是自定义的 <code>Hooks</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useClickAway</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    onClickAway, </span></span></span><br><span class="line"><span class="function"><span class="params">    dom, </span></span></span><br><span class="line"><span class="function"><span class="params">    eventName = <span class="string">'click'</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> element = useRef()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handler = useCallback(</span><br><span class="line">        event =&gt; &#123;</span><br><span class="line">          <span class="keyword">const</span> targetElement = <span class="keyword">typeof</span> dom === <span class="string">'function'</span> ? dom() : dom</span><br><span class="line">          <span class="keyword">const</span> el = targetElement || element.current</span><br><span class="line">          <span class="keyword">if</span> (!el || el.contains(event.target)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          onClickAway(event)</span><br><span class="line">        &#125;,</span><br><span class="line">        [element.current, onClickAway, dom],</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.addEventListener(eventName, handler)</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">document</span>.removeEventListener(eventName, handler)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, [eventName, handler])</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> element</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一般情况下没有问题…但是中间遇到很奇怪的bug…原因没有研究出来</p><p>最后还是用 <code>eventEmitter</code> 解决的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// com/toolbox.js</span></span><br><span class="line"><span class="keyword">const</span> ToolBox = <span class="function">(<span class="params">&#123; handleClickAway &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    emitter.on(<span class="string">'toolbox.destory'</span>, handleClickAway)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> emitter.off(<span class="string">'toolbox.destory'</span>, handleClickAway)</span><br><span class="line">  &#125;, [])</span><br><span class="line">  <span class="keyword">const</span> ref = useClickAway(<span class="function"><span class="params">()</span> =&gt;</span> handleClickAway())</span><br><span class="line">  <span class="keyword">const</span> handleItemClick = <span class="function"><span class="params">e</span> =&gt;</span> handleClickAway()</span><br><span class="line">  <span class="keyword">return</span> (&lt;div ref=&#123;ref&#125; onClick=&#123;e =&gt; handleItemClick(e)&#125;&gt;...&lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在点击某个元素的时候, 以实现 useClickAway 的效果</span></span><br><span class="line">emitter.emit(<span class="string">'toolbox.destory'</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;EventEmitter&quot;&gt;&lt;a href=&quot;#EventEmitter&quot; class=&quot;headerlink&quot; title=&quot;EventEmitter&quot;&gt;&lt;/a&gt;EventEmitter&lt;/h2&gt;&lt;h4 id=&quot;非嵌套关系的组件实现通信&quot;&gt;&lt;a href=&quot;#非
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>useEffect深入学习</title>
    <link href="http://yoursite.com/2020/01/14/useEffect%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0/"/>
    <id>http://yoursite.com/2020/01/14/useEffect深入学习/</id>
    <published>2020-01-13T16:17:38.000Z</published>
    <updated>2020-01-13T16:17:38.984Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>setTimeout和Promise看eventloop</title>
    <link href="http://yoursite.com/2020/01/04/setTimeout%E5%92%8CPromise%E7%9C%8Beventloop/"/>
    <id>http://yoursite.com/2020/01/04/setTimeout和Promise看eventloop/</id>
    <published>2020-01-04T03:05:57.000Z</published>
    <updated>2020-01-04T04:51:07.454Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://thinkerhope.github.io/2020/01/04/setTimeout%E5%92%8CPromise%E7%9C%8Beventloop/eloop.png" alt="eloop"></p><p>大家都知道<code>JS</code>是单线程的。设计的原因就是因为简单…</p><p>举了个栗子说，两个线程，有一个线程在添加一个<code>dom</code>元素 <code>a</code>，还有一个线程在删除一个<code>dom</code>元素<code>a</code>，那么浏览器就需要决策该听谁的，这样的话就增加了语言设计的复杂性。</p><h4 id="JS并非只有一个线程，而只是主线程是单线程的"><a href="#JS并非只有一个线程，而只是主线程是单线程的" class="headerlink" title="JS并非只有一个线程，而只是主线程是单线程的"></a><strong>JS并非只有一个线程，而只是主线程是单线程的</strong></h4><p>HTML5有一个api，webworker，利用它，能帮助我们创建<strong>子线程</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.html</span></span><br><span class="line"><span class="keyword">let</span> worker = <span class="keyword">new</span> Worker(<span class="string">'./worker.js'</span>);</span><br><span class="line"><span class="comment">//把内容发给 工作线程，工作线程可以把结果丢回来</span></span><br><span class="line"></span><br><span class="line">worker.postMessage(<span class="string">'向你雇佣的工人发送指令'</span>);</span><br><span class="line"></span><br><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.data); <span class="comment">//数据在data属性下</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//worker.js</span></span><br><span class="line"><span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(e);</span><br><span class="line">  <span class="keyword">this</span>.postMessage(<span class="string">'你的工人告诉你他收到命令开始干活了!'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：他和<code>js</code>主线程不是平级的，主线程可以控制<code>webworker</code>，<code>webworker</code>不能操作<code>dom</code>，不能获取<code>document</code>以及<code>window</code>。</p><p>既然是单线程，那<code>Js</code>是怎么处理异步任务呢？停下来等待的话，CPU资源利用率得有多低啊…</p><h4 id="异步任务以及事件循环"><a href="#异步任务以及事件循环" class="headerlink" title="异步任务以及事件循环"></a><strong>异步任务以及事件循环</strong></h4><p>为了解决这个问题，<code>Javascript</code>将任务的执行方式分为两种：<code>同步/synchronous</code> 和 <code>异步/asynchronous</code></p><p>在浏览器内核中，除了<code>JS线程</code>和<code>用户界面后端/UI Backend线程</code>，还有一些其它的线程，比如说<code>浏览器事件触发线程(对应上图的events)</code>、<code>定时器触发线程(timing，我的理解：在stack中如果遇到setTimeout的异步任务，就交给WebAPIs，定时到了，该线程就触发，把回调返回，推入到宏任务队列)</code>、<code>异步HTTP请求线程(ajax)</code>，而异步任务就是分发给这些线程来处理的。</p><h4 id="EventLoop-事件的循环检测机制"><a href="#EventLoop-事件的循环检测机制" class="headerlink" title="*EventLoop *- 事件的循环检测机制"></a>*<em>EventLoop *</em>- 事件的循环检测机制</h4><p>事件环就是<code>Javascript</code>主线程从<code>callback queue</code>中不断读取事件到执行栈(<code>stack</code>)的这种循环的过程。</p><h4 id="从setTimeout和Promise出发深入了解一下同步异步的微任务宏任务"><a href="#从setTimeout和Promise出发深入了解一下同步异步的微任务宏任务" class="headerlink" title="从setTimeout和Promise出发深入了解一下同步异步的微任务宏任务"></a><strong>从<code>setTimeout</code>和<code>Promise</code>出发深入了解一下同步异步的微任务宏任务</strong></h4><p><strong>单独使用的执行模式</strong></p><p>1.最初的试探</p><p>执行代码，<code>Promise</code>的基本使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    resolve(<span class="number">3</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 执行</span></span><br><span class="line">fn().then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data))</span><br></pre></td></tr></table></figure><p>以上代码，输出结果为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="comment">// 同步</span></span><br><span class="line"><span class="number">2</span> <span class="comment">// 同步</span></span><br><span class="line"><span class="number">4</span> <span class="comment">// 同步</span></span><br><span class="line"><span class="number">3</span> <span class="comment">// 异步</span></span><br></pre></td></tr></table></figure><p>注意 <code>new Promise()</code>是同步方法，<code>resolve</code>才是异步方法。<br>此外，上面的方法，可以有下面这种写法，效果等同，主要是把<code>Promise</code>精简了一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">let</span> a = <span class="built_in">Promise</span>.resolve(<span class="number">3</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行</span></span><br><span class="line">fn().then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data))</span><br></pre></td></tr></table></figure><p>因为现在讨论的是<code>Promise</code>的异步功能，所以下面均使用第二种写法的<code>Promise</code></p><p>2.多个同级<code>Promise</code></p><p>编辑器中，输入以下代码，多个同级的单层的<code>Promise</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.1'</span>)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.2'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.3'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.2'</span>)</span><br></pre></td></tr></table></figure><p>则会依次输出以下打印，毫无疑问的结果：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">同步<span class="number">-0.1</span></span><br><span class="line">同步<span class="number">-0.2</span></span><br><span class="line">P<span class="number">-1.1</span></span><br><span class="line">P<span class="number">-1.2</span></span><br><span class="line">P<span class="number">-1.3</span></span><br></pre></td></tr></table></figure><p>3.<code>Promise</code>套<code>Promise</code></p><p>复杂一点的栗子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.1'</span>)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.1'</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 新加行</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'P-2.1'</span>) <span class="comment">// 新加行</span></span><br><span class="line">  &#125;) <span class="comment">// 新加行</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.2'</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 新加行</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'P-2.2'</span>) <span class="comment">// 新加行</span></span><br><span class="line">  &#125;) <span class="comment">// 新加行</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.3'</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 新加行</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'P-2.3'</span>) <span class="comment">// 新加行</span></span><br><span class="line">  &#125;) <span class="comment">// 新加行</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.2'</span>)</span><br></pre></td></tr></table></figure><p>输出结果如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">同步<span class="number">-0.1</span></span><br><span class="line">同步<span class="number">-0.2</span></span><br><span class="line">P<span class="number">-1.1</span></span><br><span class="line">P<span class="number">-1.2</span></span><br><span class="line">P<span class="number">-1.3</span></span><br><span class="line">P<span class="number">-2.1</span></span><br><span class="line">P<span class="number">-2.2</span></span><br><span class="line">P<span class="number">-2.3</span></span><br></pre></td></tr></table></figure><p>可见，多层<code>Promise</code>是一层一层执行的。</p><p>4.为了最终确认，进行最后一次验证，在第一个<code>Promise</code>里面多加一层：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.1'</span>)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.1'</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'P-2.1'</span>)</span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 新加行</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'P-3.1'</span>) <span class="comment">// 新加行</span></span><br><span class="line">    &#125;) <span class="comment">// 新加行</span></span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 新加行</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'P-3.2'</span>) <span class="comment">// 新加行</span></span><br><span class="line">    &#125;) <span class="comment">// 新加行</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.2'</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'P-2.2'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.3'</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'P-2.3'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.2'</span>)</span><br></pre></td></tr></table></figure><p>输出结果如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">同步<span class="number">-0.1</span></span><br><span class="line">同步<span class="number">-0.2</span></span><br><span class="line">P<span class="number">-1.1</span></span><br><span class="line">P<span class="number">-1.2</span></span><br><span class="line">P<span class="number">-1.3</span></span><br><span class="line">P<span class="number">-2.1</span></span><br><span class="line">P<span class="number">-2.2</span></span><br><span class="line">P<span class="number">-2.3</span></span><br><span class="line">P<span class="number">-3.1</span></span><br><span class="line">P<span class="number">-3.2</span></span><br></pre></td></tr></table></figure><p><code>js</code>确认完毕，的确是一层一层的执行。</p><p>而且这里可以告诉大家，<code>setTimeout</code>和<code>setInterval</code>在单独使用的时候，和<code>Promise</code>是一样的，同样是分层执行，这里不再贴代码了（友情提醒：<code>setInterval</code>的话，需要第一次执行就把这个定时器清掉，否则就无限执行，卡死页面秒秒钟的事儿）</p><p><strong>混合使用的执行模式</strong></p><p>将<code>setTimeout</code>和<code>Promise</code>进行混合操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.1'</span>)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'S-1.1'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.2'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'S-1.2'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.2'</span>)</span><br></pre></td></tr></table></figure><p>执行结果如下。。。问题暴露出来了：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">同步<span class="number">-0.1</span></span><br><span class="line">同步<span class="number">-0.2</span></span><br><span class="line">P<span class="number">-1.1</span></span><br><span class="line">P<span class="number">-1.2</span></span><br><span class="line">S<span class="number">-1.1</span></span><br><span class="line">S<span class="number">-1.2</span></span><br></pre></td></tr></table></figure><p>在同级情况下，是<code>Promise</code>执行完了<code>setTimeout</code>才会执行</p><p>这就要涉及到<code>宏任务(macro task)</code>和<code>微任务(micro task)</code>了</p><p><code>JS</code>开始执行的时候，就开启一个宏任务(<code>script</code>)，然后执行一条条的指令。</p><p><code>JS</code>每次执行完当前的<code>stack</code>之后，都会从<code>callback queue</code>中的宏任务队列取出头部的一个宏任务加入到<code>stack</code>中（执行过程中遇到<code>setTimeout()</code>、<code>resolve()</code>和<code>ajax.then()</code>这种异步任务则给<code>WebAPIs</code>，异步任务完成后（如<code>setTimeout</code>定时到了、<code>ajax</code>返回了结果），就会触发相应的线程，将它们的回调推入到<code>callback queue</code>中，<code>setTimeout</code>的回调推入到宏任务队列，<code>resolve</code>和<code>ajax.then</code>的回调会被推入到微任务队列），每一个宏任务后面都跟着一个微任务队列，每次宏任务执行完，主线程就会去查微任务队列，如果不为空，则清空微任务队列，之后重复该循环。</p><p>现在如果执行下面的代码，结果也显而易见吧：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.1'</span>)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.1'</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 新加行</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'P-2.1'</span>) <span class="comment">// 新加行</span></span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 新加行</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'P-3.1'</span>) <span class="comment">// 新加行</span></span><br><span class="line">    &#125;) <span class="comment">// 新加行</span></span><br><span class="line">  &#125;) <span class="comment">// 新加行</span></span><br><span class="line">&#125;)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'S-1.1'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'P-1.2'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'S-1.2'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'同步-0.2'</span>)</span><br></pre></td></tr></table></figure><p>执行结果如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">同步<span class="number">-0.1</span></span><br><span class="line">同步<span class="number">-0.2</span></span><br><span class="line">P<span class="number">-1.1</span></span><br><span class="line">P<span class="number">-1.2</span></span><br><span class="line">P<span class="number">-2.1</span></span><br><span class="line">P<span class="number">-3.1</span></span><br><span class="line">S<span class="number">-1.1</span></span><br><span class="line">S<span class="number">-1.2</span></span><br></pre></td></tr></table></figure><p>无论<code>Promise</code>套用多少层，都会在下一个<code>setTimeout</code>之前执行。</p><h4 id="Dom操作到底是同步，还是异步"><a href="#Dom操作到底是同步，还是异步" class="headerlink" title="Dom操作到底是同步，还是异步"></a><code>Dom</code>操作到底是同步，还是异步</h4><p><strong>这里直接说明：js里面的Dom操作代码，是同步执行，但浏览器进行的Dom渲染，是异步操作。</strong></p><p><strong>浏览器渲染Dom和执行js，同时只能二选一，渲染一次Dom的时机(GUI渲染)是，当前宏任务和小尾巴微任务执行完，下一个宏任务开始前</strong></p><p><code>vue</code>的方法，则是使用<code>HTML5</code>的<code>Api</code>—<code>MutationObserver</code>，监听浏览器将<code>Dom</code>渲染完成的时机。</p><p>上面也说了，浏览器渲染一次Dom，是下一个宏任务开始前，这样使用了<code>setTimeout</code>，保证了Dom确实渲染完成。</p><p>这里也需要稍作提醒，<code>javascript</code>操作Dom是同步的，但操作Dom，毕竟超出了<code>javascript</code>本身语言的<code>Api</code>，每操作一次Dom，都需要消耗一定的性能，所以，在适合的情况下，最好先把要修改的Dom的内容，以字符串或者虚拟Dom的形式拼接好，然后操作一次Dom，把组装好的Dom字符串或虚拟Dom，一次性的塞进HTML页面的真实Dom中。</p><h4 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="built_in">Date</span>.now());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Math</span>.random());</span><br><span class="line">    <span class="keyword">let</span> now = <span class="keyword">await</span> A();</span><br><span class="line">    <span class="built_in">console</span>.log(now);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">B();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>其实，<code>async/await</code> 只是 <code>Promise+generator</code> 的一种语法糖而已。上面的代码我们改写为这样，可以更加清晰一点：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Math</span>.random());</span><br><span class="line">    A().then(<span class="function"><span class="keyword">function</span>(<span class="params">now</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(now);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">B();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>这样我们就能明白输出的先后顺序了： 1, 0.4793526730678652(随机数), 2, 1557830834679(时间戳);</p><h4 id="requestAnimationFrame"><a href="#requestAnimationFrame" class="headerlink" title="requestAnimationFrame"></a>requestAnimationFrame</h4><p><code>requestAnimationFrame</code>也属于异步执行的方法，但该方法既不属于宏任务，也不属于微任务。按照<code>MDN</code>中的定义：</p><blockquote><p><code>window.requestAnimationFrame()</code> 告诉浏览器——你希望执行一个动画，并且要求浏览器在下次重绘之前调用指定的回调函数更新动画。该方法需要传入一个回调函数作为参数，该回调函数会在浏览器下一次重绘之前执行</p></blockquote><p><code>requestAnimationFrame</code>是<code>GUI</code>渲染之前执行，但在微服务之后，不过<code>requestAnimationFrame</code>不一定会在当前帧必须执行，由浏览器根据当前的策略自行决定在哪一帧执行。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://thinkerhope.github.io/2020/01/04/setTimeout%E5%92%8CPromise%E7%9C%8Beventloop/eloop.png&quot; alt=&quot;eloop&quot;&gt;&lt;/p&gt;
&lt;p&gt;大家都知道&lt;code
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>2019总结</title>
    <link href="http://yoursite.com/2019/12/31/2019%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2019/12/31/2019总结/</id>
    <published>2019-12-31T14:14:31.000Z</published>
    <updated>2019-12-31T23:08:47.417Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://thinkerhope.github.io/2019/12/31/2019%E6%80%BB%E7%BB%93/timg.jpeg" alt="timg"></p><p>​    2019是我人生中很重要很重要的一年，特地在最后一天写这篇日志记录下来，旨在总结19年的经历和成果，以及20年的展望和期待。</p><p>​    第一件事算是祛除我的黑眼圈了吧，其实从高考结束后我就意识到这个问题了，只是条件不允许，就先忍下来了。大学后，意识到自己重重的黑眼圈已经影响到自己的生活了（大部分原因是自己过于敏感脆弱吧，呵呵），我终于决定想通过医美的方式来除掉黑眼圈了，想得跟简单，不就做个手术割掉嘛…当我去了江西省人民医院，我想算是我们那最好的三甲医院了吧。医生说黑眼圈不好办，不能手术…于是建议做射频…3次一点效果都没有，最后还忍受了两次激光的折磨，也是一点效果都没有，因为这个时间正好是寒假，在南昌和赣州往返了不下五趟吧，而且还有2趟是站票，别提多难受了，关键到最后一点效果都没有，还坑了家里面的钱。大二下吧，临近暑假的时候，我鼓起勇气去了秦皇岛市第一医院，咨询了医美科的主任医生，医生说黑眼圈是无法通过手术的方式来治疗的，而且我还发现原来我还有眼袋以及上睑下垂，哭了，我命苦啊。我通过医生了解到上睑下垂是可以通过手术方式来治疗的，就和做双眼皮一样…我没多想决定做了，我妈带我去了广州的一家私人医美整形机构…所谓的整形顾问给我出了一套方案，我啥没想，只想快点见到改变后的自己…好吧，到现在还觉得那个所谓的顾问很是浮夸。手术持续了2个小时吧，就当自己做了个很贵的双眼皮手术吧，不想被其他人知道，就一直藏在心里吧，这个秘密。</p><p>​    第二件事应该是我加入了工作室吧。不洗碗工作室从大二下学期，也就是4月份的时候开始招我们这一批的，主要面向大二（快大二）的学弟学妹，我算是个唯一一个大三（快大三）去工作室的，也就是跟着一个pdf上的文件跟着学而已，其实感觉到快要面试的时候，依然感觉没怎么学…哈哈，可能是其他人比我还菜吧。总之，之间的每一次任务都有很认真地完成，虽然学习效率和学习方法上面还有很大的问题，但是…我只能尽我目前有的最大能力，是吧。好在到7月份工作室负责人雷鹏飞面试了我，在9月份的时候有把我拉进了4.0的群，我很开心，能加入工作室，早就听闻工作室有个去小米实习的吴东很厉害，也终于意味着我不用一直一个人了。工作室的氛围很好，人才济济。虽然项目不多，也能自己和学弟一起完成或者尝试开发一些demo性质的项目吧。</p><p>   第三件事，大二时心理健康课同一组的一个女生邀请我信息经济学和她一组，我还有点小惊喜，平时不爱说话，没啥人缘的我，竟然被人主动邀请了。没多想就答应了，没曾想这是我噩梦的开始…呵呵，原本就没打算在这个无聊的学校，无聊的教室会和一群无聊的同学有什么交集，而且这个学期我的目标算是很明确了，找个前端的实习工作，完成几个项目，眼前的人本来就与我无关。后座同组的女生和我打招呼，问我问题，说了几次话后，我并没有在意，也没有记住她的样子，更不知道，也没有兴趣问名字，可能是穿着黑色的外套吧…emmm，感觉品味很差，就这样吧，哈哈。之后上课，我坐在她后面，每次她转过头来，我都刚好望向她那边，次数多了发现她…她侧脸好好看啊，而且她侧着脸，噘着嘴望向我好可爱啊…我开始想了解她，我翻了她的qq资料，对她的qq签名印象很深刻，凡心所向，素履以往…从此就成了我最喜欢的一句。虽然之后再上了两节课，才记住她长什么样。好几次在路上遇到 她，觉得她走路的气质很好，虽然个子不高，颜值也高不到哪里去，在大部分人的眼中应该是没有很特别的那种女生吧，但是我好像真的有点喜欢上她了，有一点点。我开始期待每一节课，每一节能和她坐一起的课，每一节能看见她的课，我开始期待…这也是我坠入深渊的开始，脑袋里不间断地出现同一个人，声音和模样，我开始变得贪婪，我不再满足于只是她简单地回头找我说几句话，开始主动找她，我喜欢拽她的帽子和衣角，时不时会抓她的头发，喜欢趁她回头对我笑的时候用笔戳她的肩膀，我真的真的好喜欢她在我身边带给我的那种的温度，有点暖暖的，也有一点凉凉的那种感觉，我开始抱怨信息经济学课怎么这么少…周二过去，就开始煎熬地等待周四…我也不知道为什么，其它课都不敢坐她旁边，即使坐一起了，又能怎样，话也说不上几句，我这该死的怂货，也不知道怎么找话题…，就这样很难受地一直期待她来找我说话。但是她的每一次回头都能让我精神百倍，虽然可能不是看向我，哈哈。好吧…国庆快结束的时候，我终于下定决心约她出来玩啦，那天的我真的觉得自己就是世界上最勇敢的人了。在国庆临近的时候，别人都是特别开心的，我却开心不起来…1个星期都看不到她，要我怎么过呢。其实，国庆第一天，我就给她发了一个txt文件，到现在还在，哈哈。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6211</span> <span class="number">559</span>c <span class="number">6</span>b22 <span class="number">4</span>f60<span class="number">-115</span><span class="number">-106</span><span class="number">-121</span></span><br></pre></td></tr></table></figure><p>我当时发的就是一个解析这个16进制的程序，log的是”宋俊谕，我喜欢你”。告诉了她把代码复制到chrome console按回车就可以了，按道理她挺聪明的，应该能猜到什么意思了…就忐忑地等了一天没有任何消息了，我想我是不是被讨厌了啊…哈哈，第二天，因为之前答应了她把那个登录的代码发她，虽然她可能也没有怎么在意，不过我还是很认真地…又担心她不会用，就重写了一份发给她。好吧，约会那天由于各种原因，晚上一起在东操场散了几圈步，也不算特别尴尬吧，我挺喜欢和她聊天的，虽然我不会和不熟悉的人聊天，但是还是很开心，而且那天晚上她披着头发，不过我喜欢她扎着头发的样子，干净整洁。虽然最后因为各种原因，各奔东西了，哈哈，以后也不会有交集了吧。释怀了，几天后我终于从这种无尽的痛苦中解脱了，我认识到及时止损的重要性…不然越陷越深，到最后只有自己傻傻地受伤。自动多情真的很卑微。好吧，就我一个人知道为什么之后有段时间，眼睛一直带血丝，嘻嘻，我去医院割了眼袋，虽然效果不是很好，不过算是一种麻痹自己吧，想快点忘记。</p><p>​    最大的一件事，就是我拿到北京小米科技的实习offer啦，真的很开心，这是我人生中的第一份工作。这段时间面试了今日头条、快手、小米，头条是我的第一次尝试吧，当时也不知道自己哪来的勇气和冲劲，就想着去尝试一下。还要感谢一下头条的一面和二面面试官吧，人很nice，很可惜吧，在我拿入职小米后，头条又给我发了面试邀请，我答应了…但是我把面试官给鸽了，没有在约定的时间面试，也没有提前和HR联系取消面试…到现在还自责。小米面试是现场面的，第一次来到西二旗小米科技园，哇!好华丽的现代建筑，在这里工作的人肯定很幸福吧，我很喜欢自己的一面和二面面试官，leader也很nice。真的很开心，加入了MIAI-FE，和小爱同学一起…开始一段难忘的人生经历…</p><p>   <img src="https://thinkerhope.github.io/2019/12/31/2019%E6%80%BB%E7%BB%93/IMG_20200101_064702.jpg" alt="IMG_20200101_064702"></p><p>   故事依然在继续…跟着自己的内心，就这样一直走下去吧。</p><p>​    展望2020，考研、2020东京奥运会、秋招…总之会是充满奇迹的一年吧。给自己立一波flag，系统学习JS(《Javascript权威指南》)，我大前端不能丢(HTML5的两本高效指南)为秋招做准备，基于React的项目不少于2个，开始学习Vue，Github开源项目学习不低于5个，顺利地完成学业，还有达成那个创新创业学分的指标。别忘了，自己说的，除了指上的代码，还有眼里的星辰呢，希望20年可以找到中意的女生吧，总得在学校留下点什么回忆啥的，是吧…希望自己喜欢的人也能喜欢自己吧，还有就是把自己过于在人多的地方会慌张的毛病矫正过来。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://thinkerhope.github.io/2019/12/31/2019%E6%80%BB%E7%BB%93/timg.jpeg&quot; alt=&quot;timg&quot;&gt;&lt;/p&gt;
&lt;p&gt;​    2019是我人生中很重要很重要的一年，特地在最后一天写这
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>使用hooks来优化性能</title>
    <link href="http://yoursite.com/2019/12/05/%E4%BD%BF%E7%94%A8hooks%E6%9D%A5%E4%BC%98%E5%8C%96%E6%80%A7%E8%83%BD/"/>
    <id>http://yoursite.com/2019/12/05/使用hooks来优化性能/</id>
    <published>2019-12-05T03:38:43.000Z</published>
    <updated>2019-12-05T03:53:56.042Z</updated>
    
    <content type="html"><![CDATA[<ol><li>调用setState，就会触发组件的重新渲染，无论前后的state是否不同</li><li>父组件更新，子组件也会自动的更新</li></ol><p>基于上面的两点，我们通常的解决方案是：使用immutable进行比较，在不相等的时候调用setState；在shouldComponentUpdate中判断前后的props和state，如果没有变化，则返回false来阻止更新。</p><h4 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h4><p>糟糕的代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">WithoutMemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> [val, setValue] = useState(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">expensive</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'compute'</span>);</span><br><span class="line">        <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count * <span class="number">100</span>; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">        &lt;h4&gt;&#123;count&#125;-&#123;val&#125;-&#123;expensive()&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+c1&lt;/button&gt;</span><br><span class="line">            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setValue(event.target.value)&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>每次<code>count</code>或者<code>val</code>变化都会触发组件的重新渲染，<code>expensive()</code>函数就会重新执行。</p><p>使用useMemo</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">WithMemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> [val, setValue] = useState(<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">const</span> expensive = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'compute'</span>);</span><br><span class="line">        <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count * <span class="number">100</span>; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;, [count]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">        &lt;h4&gt;&#123;count&#125;-&#123;expensive&#125;&lt;/h4&gt;</span><br><span class="line">        &#123;val&#125;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+c1&lt;/button&gt;</span><br><span class="line">            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setValue(event.target.value)&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，只会在<code>count</code>值改变的时候执行函数，并且由于缓存了上一次的<code>sum</code>值，因此可以放心地获取到最新的<code>sum</code>值。</p><h4 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h4><p><strong>使用场景</strong>是：有一个父组件，其中包含子组件，子组件接收一个函数作为props；通常而言，如果父组件更新了，子组件也会执行更新；但是大多数场景下，更新是没有必要的，我们可以借助useCallback来返回函数，然后把这个函数作为props传递给子组件；这样，子组件就能避免不必要的更新。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useCallback, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> [val, setVal] = useState(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> callback = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;, [count]);</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">        &lt;h4&gt;&#123;count&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;Child callback=&#123;callback&#125;/&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setVal(event.target.value)&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(&#123; callback &#125;) &#123;</span><br><span class="line">    const [count, setCount] = useState(() =&gt; callback());</span><br><span class="line">    useEffect(() =&gt; &#123;</span><br><span class="line">        setCount(callback());</span><br><span class="line">    &#125;, [callback]);</span><br><span class="line">    return &lt;div&gt;</span><br><span class="line">        &#123;count&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul><li>可以发现和useEffect很像，最大的不同是，useEffect可以处理副作用，但是useMemo和useCallback不可以</li><li>useCallback返回的是缓存的函数，我们可以借助ES6的set数据结构来判断这个函数是否发生改变</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;调用setState，就会触发组件的重新渲染，无论前后的state是否不同&lt;/li&gt;
&lt;li&gt;父组件更新，子组件也会自动的更新&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;基于上面的两点，我们通常的解决方案是：使用immutable进行比较，在不相等的时候调用setState；
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>通过HOC实现分层权限的路由</title>
    <link href="http://yoursite.com/2019/12/05/%E9%80%9A%E8%BF%87HOC%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B1%82%E6%9D%83%E9%99%90%E7%9A%84%E8%B7%AF%E7%94%B1/"/>
    <id>http://yoursite.com/2019/12/05/通过HOC实现分层权限的路由/</id>
    <published>2019-12-04T23:47:35.000Z</published>
    <updated>2019-12-04T23:59:52.287Z</updated>
    
    <content type="html"><![CDATA[<p>假设某应用中有以下三个页面：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">登陆页----Home.jsx</span><br><span class="line">页面A----PageA.jsx</span><br><span class="line">页面B----PageB.jsx</span><br></pre></td></tr></table></figure><p>有以下三种用户：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">游客（未登录）---只能访问登陆页</span><br><span class="line">普通用户（已登陆）---能访问登陆页及页面A</span><br><span class="line">管理员（已登陆）---能访问所有页面</span><br></pre></td></tr></table></figure><p>具体需求如下：</p><ul><li>游客访问除登陆页以外的页面时自动跳到登陆页。</li><li>普通用户访问页面B时页面显示无权限访问</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// withUserPermission.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getUser &#125; <span class="keyword">from</span> <span class="string">'@/user.js'</span>;    <span class="comment">//  判断是否已登陆用户</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Wrapper =&gt; <span class="function"><span class="params">hocProps</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">component</span>: Component, ...rest &#125; = hocProps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> user = getUser();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Wrapper &#123;...rest&#125; component=&#123; props =&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line">                ? &lt;Component &#123;...props&#125; /&gt;</span><br><span class="line">                : &lt;Redirect to="/login" /&gt;  //  跳转到登陆页</span><br><span class="line">        &#125; &#125; /&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// withAdminPermission</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getRole &#125; <span class="keyword">from</span> <span class="string">'@/user.js'</span>;    <span class="comment">//  获取用户角色</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Wrapper =&gt; <span class="function"><span class="params">hocProps</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">component</span>: Component, ...rest &#125; = hocProps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hasPermission = (getRole() === <span class="string">'admin'</span>) ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Wrapper &#123;...rest&#125; component=&#123; props =&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> hasPermission</span><br><span class="line">                ? &lt;Component &#123;...props&#125; /&gt;</span><br><span class="line">                : &lt;h1&gt;无权限访问&lt;/h1&gt;</span><br><span class="line">        &#125; &#125; /&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>封装<code>Route</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PrivateRoutes.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> withUserPermission <span class="keyword">from</span> <span class="string">'./withUserPermission'</span>;</span><br><span class="line"><span class="keyword">import</span> withAdminPermission <span class="keyword">from</span> <span class="string">'./withAdminPermission'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UserRoute = withUserPermission(Route);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> AdminRoute = withUserPermission(withAdminPermission(Route));</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserRoute, AdminRoute &#125; <span class="keyword">from</span> <span class="string">'./PrivateRoutes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> PageLogin <span class="keyword">from</span> <span class="string">'views/PageLogin'</span>;</span><br><span class="line"><span class="keyword">import</span> PageA <span class="keyword">from</span> <span class="string">'views/PageA'</span>;</span><br><span class="line"><span class="keyword">import</span> PageB <span class="keyword">from</span> <span class="string">'views/PageB'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">        &lt;Route path=<span class="string">'/login'</span> component=&#123;PageLogin&#125; /&gt;</span><br><span class="line">        &lt;UserRoute path=<span class="string">'/pageA'</span> component=&#123;PageA&#125; /&gt;</span><br><span class="line">        &lt;AdminRoute path=<span class="string">'/pageB'</span> component=&#123;PageB&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;假设某应用中有以下三个页面：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>深入理解js中的浮点数</title>
    <link href="http://yoursite.com/2019/11/24/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3js%E4%B8%AD%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0/"/>
    <id>http://yoursite.com/2019/11/24/深入理解js中的浮点数/</id>
    <published>2019-11-24T13:51:46.000Z</published>
    <updated>2019-11-27T11:12:51.781Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>ES标准中的比较算法</title>
    <link href="http://yoursite.com/2019/11/24/ES%E6%A0%87%E5%87%86%E4%B8%AD%E7%9A%84%E6%AF%94%E8%BE%83%E7%AE%97%E6%B3%95/"/>
    <id>http://yoursite.com/2019/11/24/ES标准中的比较算法/</id>
    <published>2019-11-24T13:20:40.000Z</published>
    <updated>2019-11-24T13:48:52.448Z</updated>
    
    <content type="html"><![CDATA[<p><code>ES</code>中的 <code>==</code> 和 <code>===</code> 都很熟悉了。</p><p>两者的区别：</p><ul><li><p>== 在类型相同时，使用 === 判断，=== 在类型不同时直接<code>false</code></p></li><li><p>== 会在类型不同时，发生隐式转换</p><p>规则如下：</p><p>（1）一个 <code>null</code>，一个 <code>undefied</code>，那么<code>true</code></p><p>（2）一个字符串，一个数值，会把字符串转成数值之后再进行比较</p></li></ul><p>熟悉<code>ES6</code>不会对<code>Object.is()</code>陌生</p><p><code>NaN</code>独白：懂我的人终于出现<del>(≧▽≦)/</del>啦</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.is(<span class="literal">NaN</span>, <span class="literal">NaN</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="number">0</span>, <span class="number">-0</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>在<code>js</code>中我们一般认为正负0是不相等的，然而<code>===</code>情况下<code>NaN</code>不等于<code>NaN</code>，<code>+0</code>等于<code>-0</code></p><p>简单实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Object</span>.is) &#123;</span><br><span class="line">  <span class="built_in">Object</span>.is = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x === y) &#123; </span><br><span class="line">      <span class="comment">// 针对 +0不等于-0</span></span><br><span class="line">      <span class="comment">// 1 / -0 &lt; 0</span></span><br><span class="line">      <span class="comment">// 1 / +0 &gt; 0</span></span><br><span class="line">      <span class="keyword">return</span> x !== <span class="number">0</span> || <span class="number">1</span> / x === <span class="number">1</span> / y;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 针对 NaN等于NaN</span></span><br><span class="line">      <span class="keyword">return</span> x !== x &amp;&amp; y !== y;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里重点提到ES标准中的 <strong>SameValueZero</strong> 算法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">s.add(<span class="number">0</span>)</span><br><span class="line">s.add(<span class="literal">NaN</span>)</span><br><span class="line">s.has(<span class="number">-0</span>) <span class="comment">// true</span></span><br><span class="line">s.has(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>和<code>Object.is()</code>比较算法的区别就在 +0 和 -0是一样的。 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = [<span class="number">0</span>, <span class="literal">NaN</span>]</span><br><span class="line">a.includes(<span class="number">-0</span>) <span class="comment">// true</span></span><br><span class="line">a.includes(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>可以看出<code>includes</code>也是基于 <code>SameValueZero</code> 来比较的。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;ES&lt;/code&gt;中的 &lt;code&gt;==&lt;/code&gt; 和 &lt;code&gt;===&lt;/code&gt; 都很熟悉了。&lt;/p&gt;
&lt;p&gt;两者的区别：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;== 在类型相同时，使用 === 判断，=== 在类型不同时直接&lt;code&gt;false&lt;/co
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>移位运算符</title>
    <link href="http://yoursite.com/2019/11/23/%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/"/>
    <id>http://yoursite.com/2019/11/23/移位运算符/</id>
    <published>2019-11-23T02:20:12.000Z</published>
    <updated>2019-11-24T13:31:07.795Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JS移位运算符（-lt-lt-、-gt-gt-和-gt-gt-gt-）"><a href="#JS移位运算符（-lt-lt-、-gt-gt-和-gt-gt-gt-）" class="headerlink" title="JS移位运算符（&lt;&lt;、&gt;&gt;和&gt;&gt;&gt;）"></a>JS移位运算符（&lt;&lt;、&gt;&gt;和&gt;&gt;&gt;）</h1><p>了解一下移位运算符以及在算法中的应用</p><h2 id="“-lt-lt-”运算符"><a href="#“-lt-lt-”运算符" class="headerlink" title="“&lt;&lt;”运算符"></a>“&lt;&lt;”运算符</h2><blockquote><p>左移位运算</p></blockquote><p>在移位运算过程中，符号位始终保持不变。如果右侧空出位置，则自动填充为 0；超出 32 位的值，则自动丢弃。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">5</span> &lt;&lt; <span class="number">2</span>);  <span class="comment">//返回值20</span></span><br></pre></td></tr></table></figure><p><img src="/home/boygreen/MyBlog/source/_posts/%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/6-1ZRGG61JU.gif" alt></p><h2 id="“-gt-gt-”运算符"><a href="#“-gt-gt-”运算符" class="headerlink" title="“&gt;&gt;”运算符"></a>“&gt;&gt;”运算符</h2><blockquote><p>右移位运算</p></blockquote><p>与左移运算操作相反，它把 32 位数字中的所有有效位整体右移，再使用符号位的值填充空位。移动过程中超出的值将被丢弃。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1000</span> &gt;&gt; <span class="number">8</span>);  <span class="comment">//返回值3</span></span><br></pre></td></tr></table></figure><p><img src="/home/boygreen/MyBlog/source/_posts/%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/6-1ZRGH0003W.gif" alt></p><p>把数值 -1000 向右移 8 位，则返回值为 -4。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(-1000  &gt;&gt; 8);  //返回值 -4</span><br></pre></td></tr></table></figure><p>用算式进行演示，如图所示。当符号位值为 1 时，则有效位左侧的空位全部使用 1 进行填充。</p><p><img src="/home/boygreen/MyBlog/source/_posts/%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/6-1ZRGH214508.gif" alt></p><h2 id="“-gt-gt-gt-”运算符"><a href="#“-gt-gt-gt-”运算符" class="headerlink" title="“&gt;&gt;&gt;”运算符"></a>“&gt;&gt;&gt;”运算符</h2><blockquote><p>无符号右移位运算</p></blockquote><p>它把无符号的 32 位整数所有数位整体右移。对于无符号数或正数右移运算，无符号右移与有符号右移运算的结果是相同的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1000</span> &gt;&gt;&gt; <span class="number">8</span>);  <span class="comment">//返回值3</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1000</span> &gt;&gt; <span class="number">8</span>);  <span class="comment">//返回值3</span></span><br></pre></td></tr></table></figure><p>对于负数来说，无符号右移将使用 0 来填充所有的空位，同时会把负数作为正数来处理，所得结果会非常大所以，使用无符号右移运算符时要特别小心，避免意外错误。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">-1000</span> &gt;&gt; <span class="number">8</span>);  <span class="comment">//返回值 -4</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">-1000</span> &gt;&gt;&gt; <span class="number">8</span>);  <span class="comment">//返回值 16777212</span></span><br></pre></td></tr></table></figure><p><img src="/home/boygreen/MyBlog/source/_posts/%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/6-1ZRGHZ0200.gif" alt></p><h1 id="算法应用"><a href="#算法应用" class="headerlink" title="算法应用"></a>算法应用</h1><p>计算2进制中1的个数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NumberOf1</span>(<span class="params">n</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n===<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((n &gt;&gt;&gt; i &amp; <span class="number">1</span>) === <span class="number">1</span>)&#123;  <span class="comment">// 右移并与1进行&amp;运算</span></span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里补充一下 &amp; (位与运算)</p><p> &amp;为位与运算，将两边转为二进制<br>  进行比较的时候，如果两边数字的长度不够，就从右到左对齐，前面没有的部分补零就好</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0bxxx表示一个数为二进制</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">0b100010</span>&amp;<span class="number">0b000111</span>) <span class="comment">// 000010 - 2</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;JS移位运算符（-lt-lt-、-gt-gt-和-gt-gt-gt-）&quot;&gt;&lt;a href=&quot;#JS移位运算符（-lt-lt-、-gt-gt-和-gt-gt-gt-）&quot; class=&quot;headerlink&quot; title=&quot;JS移位运算符（&amp;lt;&amp;lt;、&amp;gt;&amp;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>函数toString的妙用(字节跳动二面)</title>
    <link href="http://yoursite.com/2019/11/21/%E5%87%BD%E6%95%B0toString%E7%9A%84%E5%A6%99%E7%94%A8/"/>
    <id>http://yoursite.com/2019/11/21/函数toString的妙用/</id>
    <published>2019-11-21T11:34:21.000Z</published>
    <updated>2019-11-21T12:19:31.941Z</updated>
    
    <content type="html"><![CDATA[<p>字节跳动（今日头条）二面出的一道题</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">sum(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>)</span><br><span class="line"><span class="comment">// 要求输出一致</span></span><br></pre></td></tr></table></figure><p>我感觉就是问一个闭包而已</p><p>我的答案(…好吧，不是现场给的)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> arg1 = <span class="built_in">Number</span>(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// if (!arg1) return 0;</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [].slice.call(<span class="built_in">arguments</span>).reduce(<span class="function">(<span class="params">prev, next</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> prev + next;</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> arg1 + sum(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>尼玛…毫无疑问，二面懵逼的挂了。</p><p>这什么鬼逻辑才想出这样…递归的后面返回是个函数，还用加法…白给</p><p>把代码改成下面这样</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sum = <span class="built_in">arguments</span>[<span class="number">0</span>] ? <span class="built_in">Number</span>(<span class="built_in">arguments</span>[<span class="number">0</span>]) : <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> tempFunc = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    sum += num;</span><br><span class="line">    <span class="built_in">console</span>.log(sum)</span><br><span class="line">    <span class="keyword">return</span> tempFunc;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [].slice.call(<span class="built_in">arguments</span>).reduce(<span class="function">(<span class="params">prev, next</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> prev + next;</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> a = tempFunc(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>))</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><p>会发现最后输出了一个函数，这时候<code>toString()</code>就派上用场了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重写tempFunc的toString</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sum = <span class="built_in">arguments</span>[<span class="number">0</span>] ? <span class="built_in">Number</span>(<span class="built_in">arguments</span>[<span class="number">0</span>]) : <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> tempFunc = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    sum += num;</span><br><span class="line">    <span class="built_in">console</span>.log(sum)</span><br><span class="line">    <span class="keyword">return</span> tempFunc;</span><br><span class="line">  &#125;</span><br><span class="line">  tempFunc.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [].slice.call(<span class="built_in">arguments</span>).reduce(<span class="function">(<span class="params">prev, next</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> prev + next;</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 注意这里的一个小细节，卡了我好久</span></span><br><span class="line">      <span class="comment">// 我直接写成tempFunc(arguments[0])了，要return a，不然add(1)(2)是undefined</span></span><br><span class="line">      <span class="keyword">const</span> a = tempFunc(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>把最后结果返回就可以了，不过这也是为了应付面试而已…肯定有更优解。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;字节跳动（今日头条）二面出的一道题&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2
      
    
    </summary>
    
    
    
      <category term="-面试" scheme="http://yoursite.com/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>观察者模式和Promise原理</title>
    <link href="http://yoursite.com/2019/11/18/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E5%92%8CPromise%E5%8E%9F%E7%90%86/"/>
    <id>http://yoursite.com/2019/11/18/观察者模式和Promise原理/</id>
    <published>2019-11-18T15:33:17.000Z</published>
    <updated>2019-11-18T15:33:17.707Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>实现将emoji表情插入到textarea指定位置</title>
    <link href="http://yoursite.com/2019/11/11/%E5%AE%9E%E7%8E%B0%E5%B0%86emoji%E8%A1%A8%E6%83%85%E6%8F%92%E5%85%A5%E5%88%B0textarea%E6%8C%87%E5%AE%9A%E4%BD%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2019/11/11/实现将emoji表情插入到textarea指定位置/</id>
    <published>2019-11-11T04:49:18.000Z</published>
    <updated>2019-11-11T04:49:18.957Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
</feed>
